<div class="forecast" name_attr="forecast">
    <h3 class="mb-3">Weather Forecast</h3>
    <hr />
    <div class="row">
        <div class="col-12">
            <div class="shadow mt-1 required">
                <input type="text" id="city-autocomplete" class="form-control" autocomplete="on" placeholder="City">
            </div>
        </div>
    </div>
    <div class="w-100 mt-5">
        <div class="loading" style="display: none;">
            <div class="spinner"></div>
            <div class="preloader">
                <div class="loading-text">LOADING...</div>
            </div>
        </div>
        <iframe id="weather-preview" frameborder="0" style="width: 100%; display: none;"></iframe>
    </div>

    <div class="col-12 btn-bottom">
        <div class="float-left">
            <button class="btn btn-primary" onclick="back(this)">Back</button>
        </div>
        <div class="float-right">
            <button class="btn btn-primary save" disabled="disabled">Save</button>
        </div>
    </div>
    
</div>

<script type="text/javascript">
    function initialize() {
        var input = document.getElementById('city-autocomplete');
        var options = {
            componentRestrictions: { country: "ua" },
            fields: ["formatted_address", "place_id", "name"],
        };

        var autocomplete = new google.maps.places.Autocomplete(input, options);
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            $('#weather-preview').hide();
            $('.forecast .loading').show();
            $('.forecast .btn-bottom button.save').prop('disabled', true);
            
            $('#weather-preview').attr('src', '/home/weather/?place_id=' + place.place_id + '/&city=' + place.name);

            setTimeout(function () {
                $('.forecast .loading').hide();
                $('#weather-preview').show();

                $('.forecast .btn-bottom button.save').prop('disabled', 
                    $('#weather-preview').contents().find('a.weatherwidget-io').length == 0);
            }, 1000);
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
